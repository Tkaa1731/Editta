@inject IJSRuntime js
<HxListLayout TFilterModel="FilterModelDto">
        <TitleTemplate>
            List of items <HxBadge Color="ThemeColor.Light" TextColor="ThemeColor.Dark" CssClass="ms-1">@ListItems?.Count</HxBadge>
        </TitleTemplate>
        <SearchTemplate>
        <HxCheckbox @bind-Value="ShowAll" @bind-Value:after="gridComponent.RefreshDataAsync" Text="Zobrazit vše" Enabled="ListItems is not null"/>
        <HxInputText Placeholder="Search" Type="InputType.Search" @bind-Value="SearchText" @bind-Value:after="gridComponent.RefreshDataAsync" Enabled="ListItems is not null" />
        </SearchTemplate>
        <CommandsTemplate>
            @if(Editable){
                <HxButton Text="New item" Color="ThemeColor.Primary" Icon="BootstrapIcon.PlusLg" OnClick="NewItemClicked" Enabled="ListItems is not null" />
            }
        </CommandsTemplate>
    
    <DataTemplate>
        <HxGrid @ref="gridComponent" ContentNavigationMode="GridContentNavigationMode.Pagination" Responsive="true" TItem="IListItem" PageSize="PageSize" DataProvider="LoadDataItems" SelectedDataItem="selectedItem" SelectedDataItemChanged="HandleSelectedDataItemChanged">
            <Columns>
                <HxGridColumn HeaderText="Id" ItemTextSelector="@(item => item.Id.ToString())" SortKeySelector="@(item => item.Id)" IsDefaultSortColumn="true" />
                <HxGridColumn HeaderText="Name" ItemTextSelector="@(item => item.Name)" SortKeySelector="@(item => item.Name)" />
                <HxGridColumn HeaderText="Description" ItemTextSelector="@(item => item.Description)" SortKeySelector="@(item => item.Description)" />
                <HxGridColumn HeaderText="Cretiondate" ItemTextSelector="@(item => item.CreationDate.ToString())" SortKeySelector="@(item => item.CreationDate)" />
                @if (Editable)
                {
                    <HxContextMenuGridColumn Context="item">
					    <HxButton Icon="@BootstrapIcon.Trash" style="color:red; padding: 0px;" Color="ThemeColor.Link" OnClick="async ()=> await DeleteItemClicked(item)" />
				    </HxContextMenuGridColumn>                    
                }
            </Columns>
        </HxGrid>
    </DataTemplate>
</HxListLayout>

@code {
    [Parameter]
    [EditorRequired]
    public List<IListItem>? ListItems 
    {
        get
        {
            if(ShowAll)
                return listItems;
            return listItems?.Where(l => l.Active).ToList();
        }
        set
        {
            listItems = value;
            SearchText = "";
        } 
    }
    private List<IListItem>? listItems;
    [Parameter]
    public IListItem? selectedItem { get; set; }
    private HxGrid<IListItem> gridComponent = new();
    [Parameter]
    public EventCallback<IListItem?> selectedItemChanged { get; set; }
    [Parameter]
    public EventCallback EventNewItem{ get; set; }
    [Parameter]
    public int PageSize { get; set; } = 15;
    [Parameter]
    public bool Editable { get; set; } = true;
    private bool ShowAll = false;
    private string SearchText = string.Empty;

    private Task<GridDataProviderResult<IListItem>> LoadDataItems(GridDataProviderRequest<IListItem> request)
    {
        IEnumerable<IListItem>? result = ListItems?.Where(c => c.Name.Contains(SearchText, StringComparison.OrdinalIgnoreCase)).ToList();

        return Task.FromResult(request.ApplyTo(result));
    }

    protected async override Task OnParametersSetAsync()
    {
        base.OnParametersSet();
        await gridComponent.RefreshDataAsync();
    }

    private async Task DeleteItemClicked(IListItem editableCultureInfo)
    {
        ListItems?.Remove(editableCultureInfo);
    await gridComponent.RefreshDataAsync();
    }

    private async Task HandleSelectedDataItemChanged(IListItem selection)
    {
        selectedItem = selection;
        await selectedItemChanged.InvokeAsync(selectedItem);
        // await dataItemEditComponent.ShowAsync();
    }


    private async Task NewItemClicked()// async
    {
        //currentItem = new();
        // await dataItemEditComponent.ShowAsync();
        await EventNewItem.InvokeAsync();
    }

    public record FilterModelDto { }

}