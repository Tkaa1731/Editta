@page "/{idModule}/"
@inject ILocalStorageService localStorage
@inject PobytneService service

<div class="container mt-5">
    <div class="row">
        <div class="col">
            <a href="@idModule/Records" class="no-link">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon Icon="@BootstrapIcon.Book" />
                        <h5 class="card-title">Evidence</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/Clients" class="no-link">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon Icon="@BootstrapIcon.People" />
                        <h5 class="card-title">Klienti</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/SeasonTicket" class="no-link disabled">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon  Icon="@BootstrapIcon.Clipboard2Check" />
                        <h5 class="card-title">Permanentky</h5>
                    </div>
                </div>
            </a>
        </div>
    <div class="w-100 mt-3"/>
        <div class="col">
            <a href="@idModule/RecordSettings" class="no-link">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon Icon="@BootstrapIcon.Gear" />
                        <h5 class="card-title">Evidence položek</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/EvidenceReports" class="no-link disabled">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon Icon="@BootstrapIcon.Wallet" />
                        <h5 class="card-title">Souhrny pokladna</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/CashRegisterReports" class="no-link">
                <div class="card floating-card">
                    <div class="card-body p-5 text-center">
                        <HxIcon Icon="@BootstrapIcon.CalculatorFill" />
                        <h5 class="card-title">Souhrny evidence</h5>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>
@code {
    [EditorRequired]
    [Parameter]
    public string idModule { get; set; } = "-1";

    [CascadingParameter]
    private Task<AuthenticationState> authenticationState { get; set; } = default!;
    [CascadingParameter]
    public ModuleWorkplace moduleWorkspace { get; set; } = default!;


    private Permition modulePermition = new Permition();

    protected async override Task OnInitializedAsync()
    {
        var authState = await authenticationState;
        if (authState.User.Identity is not null && authState.User.Identity.IsAuthenticated)
        {
            var user = await localStorage.ReadEncryptedItem<UserAccount>(LocalStorageService.USER_SESSION);
            if (user is not null)
            {
                var p = user.User.AccessPermition?.FirstOrDefault(m => m.Id.ToString() == idModule);
                if (p is not null)
                    modulePermition = p;
            }

        }

        moduleWorkspace.ModuleId = idModule;

        return;
    }
}