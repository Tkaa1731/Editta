@page "/{idModule}/"
@inject ILocalStorageService localStorage
@inject PobytneService service

<h3>@modulePermition.ModuleName</h3>
<div class="container">
    <div class="row">
        <div class="col">
            <a href="@idModule/Records" class="no-link">
                <div class="card">
                    <div class="card-body">
                        <HxIcon Icon="@BootstrapIcon.Book" />
                        <h5 class="card-title">Evidence</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/Clients" class="no-link">
                <div class="card">
                    <div class="card-body">
                        <HxIcon Icon="@BootstrapIcon.People" />
                        <h5 class="card-title">Klienti</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/Contracts" class="disabled">
                <div class="card">
                    <div class="card-body ">
                        <HxIcon  Icon="@BootstrapIcon.Clipboard2Check" />
                        <h5 class="card-title">Smlouvy</h5>
                    </div>
                </div>
            </a>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col">
            <a href="@idModule/CashRegister" class="disabled">
                <div class="card">
                    <div class="card-body">
                        <HxIcon Icon="@BootstrapIcon.Wallet" />
                        <h5 class="card-title">Pokladna</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/RecordSettings" class="no-link">
                <div class="card">
                    <div class="card-body">
                        <HxIcon Icon="@BootstrapIcon.Gear" />
                        <h5 class="card-title">Evidence položek</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col">
            <a href="@idModule/PaymentReports" class="no-link">
                <div class="card">
                    <div class="card-body">
                        <HxIcon Icon="@BootstrapIcon.CalculatorFill" />
                        <h5 class="card-title">Souhrny</h5>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

@code {
    [EditorRequired]
    [Parameter]
    public string idModule { get; set; } = "-1";

    [CascadingParameter]
    private Task<AuthenticationState> authenticationState { get; set; } = default!;
    [CascadingParameter]
    public ModuleWorkplace moduleWorkplace { get; set; } = default!;// TODO: pri zmene v URL se neprojevi zmena v ModuleWorkspace


    private Permition modulePermition = new Permition();

    protected async override Task OnInitializedAsync()
    {
        var authState = await authenticationState;
        if (authState.User.Identity is not null && authState.User.Identity.IsAuthenticated)
        {
            var user = await localStorage.ReadEncryptedItem<UserAccount>(LocalStorageService.USER_SESSION);
            if (user is not null)
            {
                var p = user.User.AccessPermition?.FirstOrDefault(m => m.Id.ToString() == idModule);
                if (p is not null)
                    modulePermition = p;
            }

        }

        moduleWorkplace.ModuleId = idModule;

        return;
    }
}